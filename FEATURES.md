# 核心功能詳細規劃

## 1. 三種輸入模式

### 1.1 文字輸入模式
- **UI 元件**: 聊天輸入框 + 發送按鈕
- **功能**:
  - 支援 Enter 發送，Shift+Enter 換行
  - 字數限制提示
  - 輸入中狀態顯示
- **技術實現**: 
  - 直接通過 REST API 發送到後端
  - 後端轉換為 Google Live API 的文字輸入

### 1.2 按鈕語音輸入（Push-to-Talk）
- **UI 元件**: 麥克風按鈕（按住說話）
- **功能**:
  - 按下開始錄音，放開結束
  - 視覺化音量指示器
  - 錄音時長限制（建議 60 秒）
- **技術實現**:
  ```javascript
  // 前端音頻捕獲
  navigator.mediaDevices.getUserMedia({ audio: true })
  // 使用 AudioWorklet 處理音頻流
  // 轉換為 16kHz, 16-bit PCM 格式
  ```

### 1.3 即時通話模式（連續對話）
- **UI 元件**: 通話開始/結束按鈕
- **功能**:
  - 持續監聽和回應
  - 智能打斷檢測
  - 背景噪音過濾
- **技術實現**:
  - 建立持久 WebSocket 連接
  - 雙向音頻流處理
  - VAD（語音活動檢測）

## 2. 對話管理系統

### 2.1 Thread（聊天室）結構
```typescript
interface Thread {
  id: string;
  userId: string;
  title: string;
  createdAt: Date;
  lastMessageAt: Date;
  metadata: {
    language: string;
    voicePreference: string;
    totalDuration: number;
  };
}

interface Message {
  id: string;
  threadId: string;
  role: 'user' | 'assistant';
  content: string;
  audioUrl?: string;
  timestamp: Date;
  transcription?: {
    text: string;
    confidence: number;
    isFinal: boolean;
  };
}
```

### 2.2 對話歷史功能
- **列表視圖**: 顯示所有 threads，按最後活動時間排序
- **搜尋功能**: 全文搜尋對話內容
- **匯出功能**: 導出為文字、JSON 或音頻檔案
- **刪除管理**: 單一對話或批量刪除

### 2.3 對話恢復機制
- **上下文載入**: 載入最近 N 條消息作為上下文
- **狀態同步**: 恢復語音設定、語言偏好
- **斷點續聊**: 從上次結束的地方繼續

## 3. 即時轉錄系統

### 3.1 轉錄顯示介面
```
┌─────────────────────────────────────┐
│ 👤 您: 正在說話...                    │
│ [音量指示器 ████████░░]              │
│                                     │
│ 中間結果: "今天天氣怎麼..."           │
│ 最終結果: "今天天氣怎麼樣？"          │
│                                     │
│ 🤖 AI: 正在回應...                   │
│ "今天天氣很好，適合外出..."           │
└─────────────────────────────────────┘
```

### 3.2 轉錄特性
- **即時顯示**: 說話時立即顯示識別結果
- **更正機制**: 顯示中間結果，最終確認時更新
- **標點符號**: 自動添加標點
- **時間戳**: 每句話的開始和結束時間

### 3.3 多語言支援
- **自動檢測**: 根據用戶語音自動識別語言
- **混合語言**: 支援中英文混合對話
- **翻譯選項**: 可選的即時翻譯功能

## 4. 進階功能

### 4.1 情緒和語氣
- **情緒檢測**: 顯示對話的情緒狀態
- **語氣調整**: 調整 AI 回應的語氣（專業、友善、幽默等）

### 4.2 語音設定
- **語速調節**: 0.5x - 2.0x 播放速度
- **音色選擇**: 多種 AI 語音可選
- **音量控制**: 獨立的輸入/輸出音量

### 4.3 智能功能
- **自動摘要**: 長對話自動生成摘要
- **關鍵詞提取**: 標記重要資訊
- **待辦事項**: 自動識別並整理待辦事項

## 5. 使用者體驗優化

### 5.1 響應式設計
- **桌面版**: 完整功能介面
- **平板版**: 優化的觸控體驗
- **手機版**: 簡化介面，重點功能

### 5.2 無障礙設計
- **鍵盤導航**: 完整的鍵盤操作支援
- **螢幕閱讀器**: ARIA 標籤支援
- **高對比模式**: 視覺輔助選項

### 5.3 效能指標
- **首次響應時間**: < 500ms
- **音頻延遲**: < 200ms
- **轉錄延遲**: < 100ms

## 實作優先順序

1. **MVP 版本**（第一週）
   - 基本的按鈕語音輸入
   - 簡單的對話顯示
   - 基礎的 Google Live API 整合

2. **基礎版本**（第二、三週）
   - 三種輸入模式完整實現
   - Thread 管理基本功能
   - 即時轉錄顯示

3. **完整版本**（第四週起）
   - 所有進階功能
   - 效能優化
   - 完整的 UI/UX